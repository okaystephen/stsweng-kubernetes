<style>
    th {
        color: #2F8250 !important;
    }
</style>

<body style="background-color: rgb(243, 243, 243); margin: 0; font-family: 'Roboto Mono';">
    <!-- Navigation Bar -->
    <!-- Sticky Vertical Navigation Bar -->
    <ul class="vertical-navbar">
        <a href="/" style=" text-decoration: none;">
            <p class="h1 shrink gradient-text"
                style="text-align: center; margin-left: 8px; margin-top: .5rem; font-family: 'Montserrat', sans-serif;">
                DoloMed <i class="far fa-hospital"></i>
            </p>
        </a>
        <hr>
        <li><a href="/profile" style="font-size: medium;">Dashboard</a></li>
        <li>
            <a href="/healthprograms" style="font-size: medium;">Health Programs</a>
        </li>
        <li><a href="/doctors" style="font-size: medium;">Doctors</a></li>
        <li><a href="/appointments" style="font-size: medium;">Appointments</a></li>
    </ul>

    <!-- Sticky Horizontal Navigation Bar -->
    <nav class="navbar navbar-expand-lg sticky-top navbar-dark"
        style="height: 72px; padding-top: 1rem; margin-left: 20%;">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
                <h6 style="font-family: 'Roboto Mono';">{{user.name.last}}, {{user.name.first}} {{user.name.middle}}
                </h6>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto mt-2 mt-lg-0" style="list-style-type: none;">
            <li class="nav-item dropdown {{#if login_active}}show{{/if}}">
                <a class="nav-link dropdown-toggle caret-off" href="#" id="navbarDropdownMenuLink"
                    data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="{{#if login_active}}true{{else}}false{{/if}}">
                    <h6>Settings</h6>
                </a>
                <div class="dropdown-menu dropdown-menu-right p-4 {{#if login_active}}show{{/if}}"
                    aria-labelledby="navbarDropdownMenuLink">
                    <div class="container-fluid m-auto text-center p-auto">
                        <form method="POST">
                            <div class="text-center px-3">
                                <h6><a href="/account" style="color:#2F8250;">Account</a></h6>
                                <hr>
                                <h6><a href="/logout" style="color:#2F8250;">Log Out</a></h6>
                            </div>
                        </form>
                    </div>
                </div>
            </li>
        </ul>
    </nav>

    <!-- End of Navigation Bar -->

    <div class="profile-content">
        <p class="h1" style="color: #2F8250 ; font-family: 'Montserrat', sans-serif; font-size:13vh;">Hello, Patient!
        </p>
        {{!-- <p style="font-size: 130px; font-family: 'Montserrat', sans-serif; color: #2F8250">Hello, Patient!</p>
        --}}
        <p style="font-size: 25px; font-family: 'Montserrat', sans-serif; color: #2F8250">Here's an overview of your
            account.</p>
        <p style="color: #5C6B6B ; font-family: 'Roboto Mono',">
            Address: {{user.address}}
            <br>
            Contact Number: {{user.phone}}
            <br>
            Birthday: {{dateFormat user.birthdate "YYYY-MM-DD"}}
        </p>
        <hr>
        <div class="card mx-auto border shadow-sm" style="width: 973px; margin-bottom: 2rem;">
            <div class="card-body" style="color: #5C6B6B ; font-family: 'Montserrat', sans-serif; font-size: 15px">
                <div class="card-title" style="font-size: 45px; font-family: 'Montserrat', sans-serif; color: #2F8250;">
                    Your
                    Appointments</div>
                <div class="card mx-auto " style="width: 913px; margin-bottom: 2rem;">
                    <div class="table-responsive text-center">
                        <table class="table text-left" id="profileapp-table">
                            <thead class=" text-primary">
                                <th style="width:51%">
                                    Appointment Name
                                </th>
                                <th style="width:22%">
                                    Time
                                </th>
                                <th style="width:22%">
                                    Date
                                </th>
                                <th class="text-center" style="width:5%"></th>
                                <th class="text-center" style="width:5%"></th>
                            </thead>
                            <tbody>
                                {{#each appList}}
                                <tr>
                                    <td>
                                        {{this.appointment_name}}
                                    </td>
                                    <td>
                                        {{dateFormat this.appointment_date "h:mm a"}}
                                    </td>
                                    <td>
                                        {{dateFormat this.appointment_date "YYYY-MM-DD"}}
                                    </td>
                                    <td class="text-center">
                                        <small><a class="btn btn-success" role="button"
                                                onclick="reschedApp('{{this._id}}')">Reschedule</a></small>
                                    </td>
                                    <td class="text-center">
                                        <small>
                                            {{!-- <a class="btn btn-danger" role="button"
                                                onclick="cancelApp('{{this._id}}', '{{this.appointment_date}}')">Cancel</a>
                                            --}}
                                            <button class="btn btn-danger"
                                                onclick="cancelApp('{{this._id}}', '{{this.appointment_date}}')">Cancel</button>
                                        </small>

                                        {{!-- // '{{this._id}}' --}}
                                    </td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        {{!-- Cancel Appointment Modal --}}
        <div class="modal fade" id="cancelAppointment" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle"></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p class="cancelMessage"></p>
                    </div>
                    <div class="modal-footer text-right" style="display:initial;">
                        {{!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> --}}
                        <button type="submit" class="btn btn-danger modalCancelButton" onclick="">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        {{!-- Success Cancel Modal --}}
        <div class="modal fade" id="successcancelAppointment" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle"></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>You've successfully cancelled the appointment.</p>
                    </div>
                    <div class="modal-footer text-right" style="display:initial;">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mx-auto border shadow-sm" style="width: 973px; margin-bottom: 2rem;">
            <div class="card-body" style="color: #5C6B6B ; font-family: 'Montserrat', sans-serif; font-size: 15px">
                <div class="card-title" style="font-size: 45px; font-family: 'Montserrat', sans-serif; color: #2F8250;">
                    Your Health
                    Programs</div>
                <div class="card mx-auto" style="width: 913px; margin-bottom: 2rem;">
                    {{#if alert}}
                    <div class="alert alert-success hide" style="margin-bottom: 20px;">You have successfuly cancelled
                        your registration to {{success}}.</div>
                    {{/if}}
                    <div class="table-responsive text-center">
                        <table class="table text-left" id="profilehp-table">
                            <thead class=" text-primary">
                                <th style="width:50%">
                                    Health Program Name
                                </th>
                                <th style="width:20%">
                                    Time
                                </th>
                                <th style="width:20%">
                                    Date
                                </th>
                                <th class="text-center" style="width:5%"></th>
                            </thead>
                            <tbody>
                                {{#each healthprograms}}
                                {{> userhprogramsCard}}
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('#profilehp-table').DataTable({
                "aaSorting": [],
                columnDefs: [{
                    orderable: false,
                    targets: [3]
                }]
            })
        });

        $(document).ready(function () {
            $('#profileapp-table').DataTable({
                "aaSorting": [],
                columnDefs: [{
                    orderable: false,
                    targets: [3, 4]
                }]
            })
        });

        function cancelApp(id, date) {
            var todayDate = new Date();
            var destDate = new Date(date);
            var Difference_In_Time = destDate.getTime() - todayDate.getTime();
            var Difference_In_Days = Difference_In_Time / (1000 * 3600 * 24);

            if (Difference_In_Days <= 7) {
                $('.modal-title').text('Cancel Notice');
                $('.cancelMessage').text('Sorry! You cannot cancel this appointment because it\'s within 7 days from now.');
                $('.modal-footer').attr('style', 'display: none');
                $('#cancelAppointment').modal('show');
            } else {
                $('.modal-title').text('Cancellation Confirmation');
                $('.cancelMessage').text('Are you sure about cancelling this appointment?');
                $('.modal-footer').attr('style', 'display: initial');
                $('.modalCancelButton').attr('onclick', 'cancelModalApp(' + '\'' + id + '\'' + ')');
                $('#cancelAppointment').modal('show');
            }
        }

        function cancelModalApp(id) {
            $.ajax({
                url: "/profile/deleteapp",
                data: { id: id },
                success: function (response) {
                    $('.modal-title').text('Successful Cancellation');
                    $('#cancelAppointment').modal('hide');
                    $('#successcancelAppointment').modal('show');
                    // window.location.href = 'profile';

                },
                error: function (xhr) { }
            });
        }

        $('#successcancelAppointment').on('hidden.bs.modal', function () {
            location.reload();
        })

        function reschedApp() {
            alert("Insert resched modal here")
        }

        function cancelHP() {
            confirm("Are you sure you want to cancel this health program?")
        }

        window.onscroll = function () { myFunction() };

        var navbar = document.getElementById("navbar navbar-expand-lg sticky-top navbar-dark");
        var sticky = navbar.offsetTop;

        function myFunction() {
            if (window.pageYOffset >= sticky) {
                navbar.classList.add("sticky")
            } else {
                navbar.classList.remove("sticky");
            }
        }
    </script>
</body>