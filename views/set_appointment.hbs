<style>
    th {
        color: #2F8250 !important;
    }
</style>

<body style="background-color: rgb(243, 243, 243); margin: 0; font-family: 'Roboto Mono';">
    <!-- Navigation Bar -->
    <!-- Sticky Vertical Navigation Bar -->
    <ul class="vertical-navbar">
        <li>
            <p class="h1 shrink gradient-text"
                style="text-align: center; margin-left: 8px; margin-top: .5rem; font-family: 'Montserrat', sans-serif;">
                DoloMed <i class="far fa-hospital"></i></p>
        </li>
        <hr>
        <li><a href="/profile" style="font-size: medium;">Dashboard</a></li>
        <li>
            <a href="/healthprograms" style="font-size: medium;">Health Programs</a>
        </li>
        <li><a href="/doctors" style="font-size: medium;">Doctors</a></li>
        <li><a href="/appointments" style="font-size: medium;">Appointments</a></li>
    </ul>

    <!-- Sticky Horizontal Navigation Bar -->
    <nav class="navbar navbar-expand-lg sticky-top navbar-dark"
        style="height: 72px; padding-top: 1rem; margin-left: 20%;">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
                <h6 style="font-family: 'Roboto Mono';">{{user.name.last}}, {{user.name.first}} {{user.name.middle}}
                </h6>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto mt-2 mt-lg-0" style="list-style-type: none;">
            <li class="nav-item dropdown {{#if login_active}}show{{/if}}">
                <a class="nav-link dropdown-toggle caret-off" href="#" id="navbarDropdownMenuLink"
                    data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="{{#if login_active}}true{{else}}false{{/if}}">
                    <h6>Settings</h6>
                </a>
                <div class="dropdown-menu dropdown-menu-right p-4 {{#if login_active}}show{{/if}}"
                    aria-labelledby="navbarDropdownMenuLink">
                    <div class="container-fluid m-auto text-center p-auto">
                        <form method="POST">
                            <div class="text-center px-3">
                                <h6><a href="/account" style="color:#2F8250;">Account</a></h6>
                                <hr>
                                <h6><a href="/logout" style="color:#2F8250;">Log Out</a></h6>
                            </div>
                        </form>
                    </div>
                </div>
            </li>
        </ul>
    </nav>

    <!-- End of Navigation Bar -->

    <div class="profile-content">
        <p class="h1" style="color: #2F8250 ; font-family: 'Montserrat', sans-serif; font-size:13vh;">Set an appointment
        </p>
        <hr>
        <div class="card mx-auto border shadow-sm pt-2" style="width: 973px; ">
            <div class="card-body">
                <div class="card mx-auto " style="width: 913px; ">
                    <form method="POST" class="needs-validation" novalidate>
                        <div class="form-group">
                            <label for="appointment_name">Doctor</label>
                            <select id="appointment_name" name="appointment_name" class="form-control" required>
                                <option selected disabled value="">Choose...</option>
                                {{#each docList}}
                                <option class="selectDoc" id="{{this._id}}" value="{{this.lname}}, {{this.fname}}">
                                    {{this.lname}}, {{this.fname}}</option>
                                {{/each}}
                            </select>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Choose a doctor.
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="appointment_date">Date</label>
                                <input type="date" class="form-control" id="appointment_date" name="appointment_date"
                                    required>
                                <div class="valid-feedback">
                                    Looks good!
                                </div>
                                <div class="invalid-feedback">
                                    Enter a valid date.
                                </div>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="appointment_time">Time</label>
                                <input type="time" class="form-control" id="appointment_time" name="appointment_time"
                                    required>
                                <div class="valid-feedback">
                                    Looks good!
                                </div>
                                <div class="invalid-feedback">
                                    Enter a valid time.
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="appointment_reason">Reason for appointment</label>
                            <textarea class="form-control" id="appointment_reason" name="appointment_reason" rows="3"
                                required></textarea>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                            <div class="invalid-feedback">
                                Enter reason for appointment.
                            </div>
                        </div>
                        <div class="form-group text-center pt-3">
                            <input type="hidden" id="appointment_docID" name="appointment_docID" value="">

                            {{!-- <input type="button" name="btn" id="submit_btn" value="Submit" class="btn btn-success"
                                data-toggle="modal" data-target="#a{{_id}}"> --}}

                            <button class="btn btn-success" id="submit_btn" type="submit"
                                onclick="confirm()">Submit</button>

                            {{!-- <a class=" btn btn-success" id="submit_btn" role="button" data-toggle="modal"
                                data-target="#a{{_id}}">Submit</a> --}}
                        </div>

                        {{!-- Set Appointment Modal --}}
                        <div class="modal fade" id="confirmAppointment" tabindex="-1" role="dialog"
                            aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">Appointment Details</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p>Date: <span id="app-date"></span></p>
                                        <p>Time: <span id="app-time"></span></p>
                                        <p>Doctor: <span id="app-doc"></span></p>
                                        <p>Reason: <span id="app-reason"></span></p>
                                        <br>
                                        <p>Ready to submit appointment?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-success">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        else {
                            //event.preventDefault();
                            $('#confirmAppointment').modal('show');
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        $(function () {
            var dtToday = new Date();

            var month = dtToday.getMonth() + 1;
            var day = dtToday.getDate();
            var year = dtToday.getFullYear();
            if (month < 10)
                month = '0' + month.toString();
            if (day < 10)
                day = '0' + day.toString();

            var maxDate = year + '-' + month + '-' + day;
            $('#appointment_date').attr('min', maxDate);
        });
    </script>

    <script>
        window.onscroll = function () { myFunction() };

        $(document).ready(function () {
            $('#appointment_name').select2();
        });

        $('#submit_btn').click(function () {
            $('#app-date').text($('#appointment_date').val());
            $('#app-time').text($('#appointment_time').val());
            $('#app-doc').text($('#appointment_name').val());
            $('#app-reason').text($('#appointment_reason').val());

            $('#appointment_docID').val($('#appointment_name').children(":selected").attr("id"));
        });

        var navbar = document.getElementById("navbar navbar-expand-lg sticky-top navbar-dark");
        var sticky = navbar.offsetTop;

        function myFunction() {
            if (window.pageYOffset >= sticky) {
                navbar.classList.add("sticky")
            } else {
                navbar.classList.remove("sticky");
            }
        }
    </script>
</body>